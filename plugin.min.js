tinymce.PluginManager.add("fileupload",function(e,a){e.addButton("fileupload",{content_style:"div { height: 50px; line-height: 50px; margin: 0; font-size: 14px;}",title:"Upload attachment",onclick:function(){var a=$(document.body),t=$('<input class="tempFileInputElement" type="file"/>')
a.append(t)
t.click(),t.on("change",function(a){function t(){s&&s.close(),s=e.notificationManager.open({text:"Error uploading image"})}function i(){if(200==this.status){var a=JSON.parse(this.response)
if(4===a.code){s&&s.close()
var t=e.dom.create("img",{src:"http://iriiisdev.com/or/gw/iriiisdocuments/files/"+a.data._id+"/download?isDownload=false",width:e.getParam("mediaWidth"),height:e.getParam("mediaHeight")})
e.selection.setNode(t),console.log(a)}else 1===a.code&&(s&&s.close(),s=e.notificationManager.open({text:"Error uploading image "+a.message}))}}function n(a){if(a.lengthComputable){var t=a.loaded/a.total*100
s||(s=e.notificationManager.open({text:"uploading image...",progressBar:!0})),s.progressBar.value(t)}}var o=a.target.files[0],r=new FormData
r.append("upload",o),r.append("name",o.name),r.append("mimeType","file"),r.append("action","upload"),r.append("parentId","0")
var l=new XMLHttpRequest,p=e.getParam("globalUserName"),d=e.getParam("SP_IDS")
e.getParam("S_IDS")
l.open("POST","/or/gw/c/files?account="+p+"@iriiisdev.com&spId="+d.IRIIISDOCUMENTS,!0),l.upload.onprogress=n,l.onload=i,l.onerror=t,l.send(r)
var s
$(".tempFileInputElement").remove()})}})})
